name: build and test

on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions: {}

jobs:
  changes:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
    outputs:
      changed: ${{ steps.filter.outputs.changed }}
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
      - name: ðŸ”Ž checking for changes
        uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3
        id: filter
        with:
          filters: |
            changed:
              - 'src/generator/**'
              - 'src/netex/**'
              - 'src/siri/**'
              - 'src/General.targets'
              - 'src/Directory.Packages.props'
              - 'packages/**'
              - 'global.json'
              - 'Spillgebees.Transmodel.slnx'

  build-and-test:
    needs: [changes]
    uses: ./.github/workflows/build-test-publish.yml
    with:
      should-run: ${{ needs.changes.outputs.changed }}
